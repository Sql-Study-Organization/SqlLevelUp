# 1장 DBMS 아키텍처
## 2강 DBMS와 버퍼

  - 일반적으로 기억장치는 기억 비용에 따라 1차부터 3차까지의 계층으로 분류한다.
  - 기억 비용은 데이터를 저장하는데 소모되는 비용
  - 많은 데이터를 영속적으로 저장하려면 속도를 읽고,
  - 속도를 얻고자 하면 데이터를 영속적으로 저장하기 힘들다는 트레이드오프가 발생한다.
 
![alt text](https://lh3.googleusercontent.com/proxy/tfWuiGcBNx5JW07rHL6mWoHb2xXnLO3Uno-KcZ6iyofA1zvPeUI6b4411OxaZ_JwTUdaLrEGzvPciqxnl5nWRnQPeasY_RSrM_NCinggXt4Up4uDiBjtuwvhRQ)


1. DBMS와 기억장치의 관계
  - 하드 디스크(HDD)
    - 2차 기억 장치로 분류
    - DBMS가 데이터를 저장하는 매체는 대부분 HDD다.(하지만 무조건은 아니다.)
    
  - 메모리 (1차 기억장치로 분류)
    - 기억비용이 비싸다.
    - 규모 있는 상용 시스템의 데이베이스 내부 데이터를 모두 메모리에 올리는 것은 불가능
  - 버퍼를 활용한 속도 향상
    - 성능향상 때문에 메모리에 올리기도 한다.
      
      -> SQL 구문의 실행속도를 빠르게 하기 위함!
    - 자주 접근하는 데이터를 메모리 위에 올려둔다면, 같은 SQL 구문을 실행한다고 해도 데이터를 가져올 필요 없이 곧바로 메모리에서 읽어 빠르게 데이터를 검색할 수 있다. 
    - 디스크 접근을 줄인다면, 굉장히 큰 폭의 성장이 가능하다.
    
     -> 일반적인 SQL 구문의 실행 시간 대부분을 I/O(입출력)에 사용하기 때문이다.
    
   - 성능 향상 목적으로 데이터를 저장하는 메모리를 버퍼 또는 캐시라고 부른다.
   - DBMS의 버퍼 매니저를 통해 데이터를 어떻게, 어느 정도의 기간 동안 올리지를 관리한다.
   
 2. 메모리 위에 있는 두 개의 버퍼
   - 데이터 캐시
     - 디스크에 있는 데이터의 일부를 메모리에 유지하기 위해 사용하는 메모리 영역
   - 로그 버퍼
     - DBMS는 갱신과 관련된 SQL구문을 사용자로부터 받으면, 곧바로 저장소에 있는 데이터를 변경하지 않는다.
     - 데이타베이스의 갱신 처리는 SQL구문의 실행 시점과 저장소에 갱신하는 시점에 차이가 있는 비동기 처리입니다.
     
3. 메모리의 성질을 초래하는 트래이드오프
  - 메모리가 가진 단점은 가격이 비싸서 보유할 수 있는 데이터양이 적다.
  
  - 휘발성
    - 메모리 위에 올라가 있는 모든 데이터가 사라진다.
    - DBMS에 어떤 장애가 발생해서 프로세스 다운(서버 죽음) 메모리위에 있는 데티어가 날라간다.
    - 영속성이 없기 때문에 디스크를 완전히 대체하는 것이 불가능하다.
  - 휘발성의 문제점
    - 데이터의 부정합
    - 데이터 캐시라면 장애로 인해 메모리 위의 데이터가 사라져버려도, 원본 데이터는 디스크 위에 남아있으므로 아무런 문제가 없다.
  - DBMS가 갱신을 비동기로 하는 이상 언제든 DMBS가 다운이 될때 로그파일이 사라지는 현상은 언제든지 발생할 수 있다.
  - 이를 회피하고자 커밋 시점에 반드시 갱신 정보를 로그파일에 씀으로써, 장애가 발생해도 정합성을 유지할 수 있게 한다.
  - DBMS는 커밋된 데이터를 영속화합니다.
  - 커밋할때는 동기가 일어난다.
  
  |이름|데이터 정합성|성능|
  |-|-|-|
  |동기 처리| O | X |
  |비동기 처리| X | O |
  
4. 시스템 특성에 따른 트레이드오프
  - 데이터 캐시와 로그 버퍼의 크기
    - 데이터 캐시 > 로그 버퍼
    - DBMS가 물리 메모리에 여유가 있다면, 데이터 캐시를 되도록 많이 할당할 것을 추천하고 있다.
  - 검색과 갱신 중에서 중요한것
    - 시스템에 걸리는 부하에 대해서 상대적으로 메모리가 많이 남는다면, 고민할 필요가 없다.
    
    -> 데이터 캐시와 로그버퍼 모두에 충분한 메모리를 할당하면 된다.
   
    -> 최근에는 리소스를 자동으로 할당하는 기능을 가진 DBMS도 있다.
    
    - 굉장히 중요한 리소스 배분이 필요한 상황에서 아무 생각없이 모든 것을 자동 설정에 의지하는 것은 굉장히 위험하다.
    - 데이터베이스가 어떤 생각에 기반을 둬서 리소를 배분하고 있는지 이해하는 것이 중요하다.
    - 로그 버퍼가 크게 잡혔다면, 갱신 처리와 관현해 큰 부하가 걸릴 것을 고혀한 설계임을 알 수 있다.
    - 데이터 캐시가 크게 잡혔다면, 검색 처리와 관련된 처리가 중심이라는 것을 알 수 있습니다.
    
5. 추가적인 메모리 영역 '워킹 메모리'
  - 정렬 또는 해시 관련 처리에 사용되는 작업용 영역을 부른다.
  - 정렬 : ORDER BY 구, 집합 연산, 윈도우 함수 등의 기능을 사용할 때 실행된다.
  - 해시 : 테이블 등의 결합에서 해시 결합이 사용될 때 실행된다.
  
  - 작업용 메모리 영역은 SQL에서 정렬 또는 해시가 필요할 때 사용되고, 
  - 종료되면 해제되는 임시 영역으로,
  - 일반적으로는 데이터 캐시와 로그 버퍼와는 다른 영역으로 관리 된다.
  
  DBMS 별 임시 메모리를 부르는 명칭
  
    1. Oracle : 임시 테이블 스페이스
    
    2. SQL server : TEMPDB
    
    3. PostgreSQL : 일시 영역
    
  - 저장소가 부족해지면?
    - 속도가 느려진다.
    - 느려지는 상황을 재현하는( 부하 검사)를 실시 하지 않으면 메모리 부족 현상이 일어날지 판별하기 어렵다.
    - 하나뿐만 아니라 여러개가 있을 때도 주의해야한다.
    - DBMS는 메모리가 부족하더라도 무언가를 처리하려고 계속 노력하는 미들웨어
    - DBMS는 느려질뿐 자바같은 프로그래밍 언어처럼 시스템을 종료시키지 않는다.
    
