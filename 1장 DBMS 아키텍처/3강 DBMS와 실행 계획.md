# 1장 DBMS 아키텍처
## 3강 DBMS와 실행 계획

1. 권한 이양의 죄약
  - RDB는 모든 일을 사용자가 아니라 시스템에 맡겼다.
  - 따라서 How가 아닌 what을 기술하는 것으로 축소 되었다.
 
  -> 비즈니스 전체의 생산성을 향상시키지 위해
  
  - 맞는 이유 : RDB가 시스템 세계의 곳곳에 침투해 있다는 것을 보면 알 수 있다.
  - 틀린 이유 : 여전히 우리는 RDB를 다루기 어렵다.
  - How를 의식하지 않고, 사용하는 것 때문에 성능 문제로 고생하는 경우도 꽤 있다.
  
2. 데이터에 접근하는 방법은 어떻게 결정할까?
  - RDB에서 데이터 접근 절차를 결정하는 모듈은 쿼리 평가 엔진이라고 부른다.
  - 파서 또는 옵티마이저와 같은 여러 개의 서브 모듈로 구성
  - 파서
    - 사용자로부터 입력받은 SQL 구분이 항상 구문적으로 올바르다는 보증이 없으므로 검사해준다.
    - SQL구문을 정형적인 형식으로 변환해준다.
    - 그렇게 해야 DBMS 내부에서 일어나는 후속 처리가 효율화 된다.
    - SQL에 한정되지는 않는다.
  - 옵티마이저
    - 최적화의 대상은 데이터 접근법입니다.
    - DBMS의 두뇌의 핵심
    - 인덱스의 유무, 데이터 분산, 편향 정도, DBMS 내부변수의 조건 고려, 선택 가능한 많은 실행 계획 작성, 
    - 이들 비용 연산 후 가장 낮은 비용을 가진 실행 계획을 선택한다.
    - 귀찮은건 기계가 대신함
  - 카탈로그 매니저
    - 옵티마이저가 실행 계획을 세울 때 옵티마이저에 중요한 정보를 제공한다.
    - 카탈로그 : DBMS의 내부 정보를 모아놓은 테이블들로 테이블 또는 인덱스의 통계 정보가 저장되어 있다.
    - 카탈로그 == 통계정보라고 부른다.
  - 플랜 평가
    - 옵티마이저가 SQL 구문에서 여러 개의 실행 계획을 세운뒤 그것을 받아 최적의 실행 결과를 선택하는 것
    - 곧바로 DBMS가 실행할 수 있는 형태의 코드가 아니다.
    - 인간이 읽기 쉽게 만들어진 문자 그대로의 계획서
3. 옵티마이저와 통계정보
  - 통계정보가 부족한 경우, 옵티마이저가 실패한다.
  - 카탈로그에 포함되어 있는 통계 정보
    - 각 테이블의 레코드 수
    - 각 테이블의 필드 수와 필드의 크기
    - 필드의 카디널리티(값의 개수)
    - 필드값이 히스토그램(어떤 값이 얼마나 분포되어 있는가)
    - 필드 내부에 있는 NULL 수'
    - 인덱스 정보
  - 데이블에 데이터 삽입/갱신/제거가 수행될 때 카탈로그 정보가 갱신되지 않는다면, 옵티마이저는 오래된 정보를 바탕으로 실행 계획을 세우게 된다.
  - SQL 구문이 늦였다고 모든 것을 옵타마이저의 탓으로 돌리는 것은 가혹하다.
  
4.최적의 실행 계획이 작성되게 하려면
  - 테이블의 데이터가 많이 바뀌면 카탈로그의 통계 정보도 함께 갱신해야 한다.
  - 데이터를 크게 갱신하는 배치 처리가 있을 때는 Job Net을 조합하는 경우도 많고,
  - Oracle처럼 기본 설정에서 정기적으로 통계 정보 갱신 작업이 수행되는 경우도 있으며, 
  - Microsoft SQL Server처럼 갱신 처리가 수행되는 시점에 자동으로 통계 정보를 갱신하는 경우도 있다.
  - 통계 정보 갱신은 실행 비용이 굉장히 높은 작업이다.
  - DBMS가 최적의 플랜을 선택하려면 필요한 조건이므로 갱신 시점을 확실하게 검토해야 한다.
  - 옵션 지정에 따라 테이블 단위가 아니라 스키마 전체를 기준으로 구하거나, 샘플링 레이트를 지정하거나, 
  - 테이블에 부텨된 인덱스의 통계 정보도 함께 구할 수 있는 등의 다양한 제어가 가능하다.
  
